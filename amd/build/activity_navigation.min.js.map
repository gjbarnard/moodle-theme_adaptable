{"version":3,"file":"activity_navigation.min.js","sources":["../src/activity_navigation.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Activity navigation main component.\n *\n * @module     theme_adaptable/core_course/activity_navigation\n * @class      theme_adaptable/core_course/activity_navigation\n * @copyright  2025 G J Barnard\n *               {@link https://moodle.org/user/profile.php?id=442195}\n *               {@link https://gjbarnard.co.uk}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport ajax from 'core/ajax';\nimport {BaseComponent} from 'core/reactive';\nimport {getCurrentCourseEditor} from 'core_courseformat/courseeditor';\nimport log from 'core/log';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\n\nexport default class Component extends BaseComponent {\n\n    static singleton = false;\n\n    /**\n     * Constructor hook.\n     */\n    create() {\n        // Optional component name for debugging.\n        this.name = 'theme_adaptable_activity_navigation';\n    }\n\n    /**\n     * Static method to create a component instance from the mustache template.\n     *\n     * @param {element|string} target the DOM main element or its ID\n     *\n     * @return {Component}\n     */\n    static init(target) {\n        if (this.singleton) {\n            log.debug(\"Adaptable activity navigation Inited\");\n        } else {\n            log.debug(\"Adaptable activity navigation Init\");\n            this.singleton = true;\n            return new this({\n                element: document.getElementById(target),\n                reactive: getCurrentCourseEditor(),\n            });\n        }\n    }\n\n    getWatchers() {\n        return [\n            {watch: `cm.completionstate:updated`, handler: this._completionstateUpdated },\n        ];\n    }\n\n    async _completionstateUpdated({element}) {\n        log.debug(\"Adaptable activity navigation _completionstateUpdated element: \" + JSON.stringify(element));\n\n        const request = {\n            methodname: 'theme_adaptable_activity_navigation',\n            args: {\n                moduleid: element.id\n            }\n        };\n\n        ajax.call([request])[0]\n            .then((jsoncontextstring) => {\n                log.debug(\"Adaptable activity navigation update: \" + jsoncontextstring);\n                if (jsoncontextstring !== \"\") {\n                    const context = JSON.parse(jsoncontextstring);\n                    Templates.renderForPromise('theme_adaptable/core_course/activity_navigation', context)\n                        .then(({ html, js }) => {\n                            Templates.replaceNodeContents('#adaptable-activity-navigation', html, js);\n                        })\n                        .catch(error => Notification.exception(error));\n                } else {\n                    Notification.addNotification({\n                        message: \"Adaptable activity navigation update navigation not generated.\",\n                        type: 'error',\n                    });\n                }\n            })\n            .catch(error => {\n                Notification.addNotification({\n                    message: error.message,\n                    type: 'error',\n                });\n            });\n    }\n}\n"],"names":["_interopRequireDefault","e","__esModule","default","_ajax","_log","_notification","_templates","Component","BaseComponent","static","create","this","name","init","target","singleton","log","debug","element","document","getElementById","reactive","getCurrentCourseEditor","getWatchers","watch","handler","_completionstateUpdated","_ref","JSON","stringify","request","methodname","args","moduleid","id","ajax","call","then","jsoncontextstring","context","parse","Templates","renderForPromise","_ref2","html","js","replaceNodeContents","catch","error","Notification","exception","addNotification","message","type","_exports"],"mappings":"sPA8BuC,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;;;;;;;;;qFALvCG,MAAAJ,uBAAAI,OAGAC,KAAAL,uBAAAK,MACAC,cAAAN,uBAAAM,eACAC,WAAAP,uBAAAO,YAEe,MAAMC,kBAAkBC,UAAAA,cAEnCC,kBAAmB,EAKnBC,MAAAA,GAEIC,KAAKC,KAAO,qCAChB,CASA,WAAOC,CAAKC,QACR,IAAIH,KAAKI,UAKL,OAFAC,KAAAA,QAAIC,MAAM,sCACVN,KAAKI,WAAY,EACV,IAAIJ,KAAK,CACZO,QAASC,SAASC,eAAeN,QACjCO,UAAU,EAAAC,cAAAA,4BANdN,KAAAA,QAAIC,MAAM,uCASlB,CAEAM,WAAAA,GACI,MAAO,CACH,CAACC,MAAO,6BAA8BC,QAASd,KAAKe,yBAE5D,CAEA,6BAAMA,CAAuBC,MAAY,IAAXT,QAACA,SAAQS,KACnCX,KAAGd,QAACe,MAAM,kEAAoEW,KAAKC,UAAUX,UAE7F,MAAMY,QAAU,CACZC,WAAY,sCACZC,KAAM,CACFC,SAAUf,QAAQgB,KAI1BC,MAAAA,QAAKC,KAAK,CAACN,UAAU,GAChBO,MAAMC,oBAEH,GADAtB,KAAAA,QAAIC,MAAM,yCAA2CqB,mBAC3B,KAAtBA,kBAA0B,CAC1B,MAAMC,QAAUX,KAAKY,MAAMF,mBAC3BG,WAASvC,QAACwC,iBAAiB,kDAAmDH,SACzEF,MAAKM,QAAkB,IAAjBC,KAAEA,KAAIC,GAAEA,IAAIF,MACfF,WAASvC,QAAC4C,oBAAoB,iCAAkCF,KAAMC,GAAG,IAE5EE,OAAMC,OAASC,cAAY/C,QAACgD,UAAUF,QAC/C,MACIC,cAAY/C,QAACiD,gBAAgB,CACzBC,QAAS,iEACTC,KAAM,SAEd,IAEHN,OAAMC,QACHC,cAAY/C,QAACiD,gBAAgB,CACzBC,QAASJ,MAAMI,QACfC,KAAM,SACR,GAEd,EACH,OAAAC,SAAApD,QAAAK,UAAA+C,SAAApD,OAAA"}