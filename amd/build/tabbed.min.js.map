{"version":3,"file":"tabbed.min.js","sources":["../src/tabbed.js"],"sourcesContent":["//\n// This file is part of Adaptable theme for moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n//\n// Adaptable Tabbed JS file\n//\n// @package    theme_adaptable\n// @copyright  2015-2019 Jeremy Hopkins (Coventry University)\n// @copyright  2018-2019 Manoj Solanki (Coventry University)\n// @copyright  2019 G J Barnard\n//               {@link https://moodle.org/user/profile.php?id=442195}\n//               {@link https://gjbarnard.co.uk}\n// @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\n//\n\nimport $ from 'jquery';\nimport log from 'core/log';\n\n/**\n * Tabbed.\n *\n * @param {string} currentpage The current page.\n * @param {string} tabpersistencetime The persistance time of the current set tab.\n */\nconst tabbed = (currentpage, tabpersistencetime) => {\n    if (currentpage == 'coursepage') {\n        var hasStorage = (\"sessionStorage\" in window && window.sessionStorage);\n        var now, expiration;\n        var currentUrl = document.location.toString();\n\n        if ((hasStorage) && (currentUrl.indexOf('course/view.php?id=') != -1)) {\n\n            var tabValues = JSON.parse(sessionStorage.getItem('tabValues')) || {};\n            var tabTimestamp = JSON.parse(sessionStorage.getItem('tabTimestamp'));\n            var $radiobuttons = $(\"#coursetabcontainer :radio\");\n            var now = new Date();\n\n            const setTimestamp = (timestamp) => {\n                var timeStampJSON = JSON.stringify(timestamp);\n                log.debug('Adaptable ES6 Tabbled: Setting timestamp to ' + timeStampJSON);\n                sessionStorage.setItem(\"tabTimestamp\", timeStampJSON);\n            };\n\n            // Check timestamp for session.\n            if (tabTimestamp) {\n                // Calculate expiration time for content, to force periodic refresh after 'tabpersistencetime' minutes.\n                expiration = new Date(tabTimestamp);\n                expiration.setMinutes(expiration.getMinutes() + parseInt(tabpersistencetime));\n                if (now.getTime() > expiration.getTime()) {\n                    log.debug('Adaptable ES6 Tabbled: Expired');\n                    sessionStorage.removeItem('tabValues');\n                    tabValues = {};\n                }\n            }\n            setTimestamp(now);\n\n            var params = (new URL(document.location)).searchParams;\n            var courseid = params.get(\"id\");\n\n            $radiobuttons.on(\"change\", function () {\n                $radiobuttons.each(function () {\n                    if (this.checked) {\n                        tabValues[courseid] = this.id;\n                    }\n                });\n                sessionStorage.setItem(\"tabValues\", JSON.stringify(tabValues));\n            });\n\n            var tabhasbeenset = false;\n            $.each(tabValues, function (key, value) {\n                if (key == courseid) {\n                    $(\"#\" + value).prop('checked', true);\n                    tabhasbeenset = true;\n                }\n            });\n            if (tabhasbeenset == false) {\n                $(\"input:radio[name=tabs]:first\").attr('checked', true);\n            }\n\n            $('label.coursetab').show();\n        }\n\n    }\n};\n\n/**\n * Init.\n  *\n * @param {string} currentpage The current page.\n * @param {string} tabpersistencetime The persistance time of the current set tab.\n*/\nexport const init = (currentpage, tabpersistencetime) => {\n    log.debug('Adaptable ES6 Tabbled init');\n    if (document.readyState !== 'loading') {\n        log.debug(\"Adaptable ES6 Tabbled init DOM content already loaded\");\n        tabbed(currentpage, tabpersistencetime);\n    } else {\n        log.debug(\"Adaptable ES6 Tabbled init JS DOM content not loaded\");\n        document.addEventListener('DOMContentLoaded', function () {\n            log.debug(\"Adaptable ES6 Tabbled init JS DOM content loaded\");\n            tabbed(currentpage, tabpersistencetime);\n        });\n    }\n};\n"],"names":["_interopRequireDefault","e","__esModule","default","_jquery","_log","tabbed","currentpage","tabpersistencetime","expiration","hasStorage","window","sessionStorage","currentUrl","document","location","toString","indexOf","tabValues","JSON","parse","getItem","tabTimestamp","$radiobuttons","$","now","Date","setTimestamp","timestamp","timeStampJSON","stringify","log","debug","setItem","setMinutes","getMinutes","parseInt","getTime","removeItem","courseid","URL","searchParams","get","on","each","this","checked","id","tabhasbeenset","key","value","prop","attr","show","_exports","init","readyState","addEventListener"],"mappings":"iGA6B2B,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA;;6EAD3BG,QAAAJ,uBAAAI,SACAC,KAAAL,uBAAAK,MAQA,MAAMC,OAASA,CAACC,YAAaC,sBACzB,GAAmB,cAAfD,YAA6B,CAC7B,IACSE,WADLC,WAAc,mBAAoBC,QAAUA,OAAOC,eAEnDC,WAAaC,SAASC,SAASC,WAEnC,GAAKN,aAA8D,GAA9CG,WAAWI,QAAQ,uBAA+B,CAEnE,IAAIC,UAAYC,KAAKC,MAAMR,eAAeS,QAAQ,eAAiB,GAC/DC,aAAeH,KAAKC,MAAMR,eAAeS,QAAQ,iBACjDE,eAAgB,EAAAC,QAACrB,SAAC,8BAClBsB,IAAM,IAAIC,KAEd,MAAMC,aAAgBC,YAClB,IAAIC,cAAgBV,KAAKW,UAAUF,WACnCG,KAAAA,QAAIC,MAAM,+CAAiDH,eAC3DjB,eAAeqB,QAAQ,eAAgBJ,cAAc,EAIrDP,gBAEAb,WAAa,IAAIiB,KAAKJ,eACXY,WAAWzB,WAAW0B,aAAeC,SAAS5B,qBACrDiB,IAAIY,UAAY5B,WAAW4B,YAC3BN,KAAAA,QAAIC,MAAM,kCACVpB,eAAe0B,WAAW,aAC1BpB,UAAY,CAAA,IAGpBS,aAAaF,KAEb,IACIc,SADU,IAAIC,IAAI1B,SAASC,UAAW0B,aACpBC,IAAI,MAE1BnB,cAAcoB,GAAG,UAAU,WACvBpB,cAAcqB,MAAK,WACXC,KAAKC,UACL5B,UAAUqB,UAAYM,KAAKE,GAEnC,IACAnC,eAAeqB,QAAQ,YAAad,KAAKW,UAAUZ,WACvD,IAEA,IAAI8B,eAAgB,EACpBxB,QAACrB,QAACyC,KAAK1B,WAAW,SAAU+B,IAAKC,OACzBD,KAAOV,YACP,EAAAf,QAACrB,SAAC,IAAM+C,OAAOC,KAAK,WAAW,GAC/BH,eAAgB,EAExB,IACqB,GAAjBA,gBACA,EAAAxB,QAAAA,SAAE,gCAAgC4B,KAAK,WAAW,IAGtD,EAAA5B,iBAAE,mBAAmB6B,MACzB,CAEJ,GAqBFC,SAAAC,KAZkBA,CAAChD,YAAaC,sBAC9BuB,KAAAA,QAAIC,MAAM,8BACkB,YAAxBlB,SAAS0C,YACTzB,KAAAA,QAAIC,MAAM,yDACV1B,OAAOC,YAAaC,sBAEpBuB,KAAAA,QAAIC,MAAM,wDACVlB,SAAS2C,iBAAiB,oBAAoB,WAC1C1B,KAAAA,QAAIC,MAAM,oDACV1B,OAAOC,YAAaC,mBACxB,IACJ,CACF"}